name: momo
on:
   push:
      branches:
         - main
env:
   NEXT_PUBLIC_API_URI: ${{ secrets.NEXT_PUBLIC_API_URI }}
jobs:
   build:
      runs-on: ubuntu-20.04
      steps:
         - name: Checkout source code.
           uses: actions/checkout@v2

         - name: Install dependencies
           run: npm install
           working-directory: ./
         - name: Build
           run: npm run build
           env:
              CI: ''
           working-directory: ./
         - name: SHOW AWS CLI VERSION
           env:
              AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
              AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
              AWS_EC2_METADATA_DISABLED: true
           run: |
              aws --version
         - name: Sync Bucket
           env:
              AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
              AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
              AWS_EC2_METADATA_DISABLED: true
           run: |
              aws s3 sync \
                --region us-east-1 \
                out s3://momo-deploy \
                --delete
           working-directory: ./
